{"version":3,"file":"miniprogramMock.min.js","sources":["../src/wxMock.ts","../src/core/MockWxApi.ts","../src/miniprogramMock.ts","../src/core/MockWxGlobal.ts"],"sourcesContent":["const wxApiName = [\n  \"drawCanvas\",\n  \"createContext\",\n  \"createCanvasContext\",\n  \"canvasToTempFilePath\",\n  \"canvasGetImageData\",\n  \"canvasPutImageData\",\n  \"createOffscreenCanvas\",\n  \"getAccountInfoSync\",\n  \"getShareInfo\",\n  \"pageScrollTo\",\n  \"chooseInvoiceTitle\",\n  \"chooseInvoice\",\n  \"arrayBufferToBase64\",\n  \"base64ToArrayBuffer\",\n  \"openSetting\",\n  \"getExtConfig\",\n  \"chooseMedia\",\n  \"chooseMultiMedia\",\n  \"chooseMessageFile\",\n  \"chooseWeChatContact\",\n  \"uploadEncryptedFileToCDN\",\n  \"onUploadEncryptedFileToCDNProgress\",\n  \"getExtConfigSync\",\n  \"showShareMenu\",\n  \"hideShareMenu\",\n  \"updateShareMenu\",\n  \"shareAppMessageForFakeNative\",\n  \"openUrl\",\n  \"setNavigationBarColor\",\n  \"setNavigationBarAlpha\",\n  \"vibrateShort\",\n  \"vibrateLong\",\n  \"getSetting\",\n  \"checkIsSupportFacialRecognition\",\n  \"startFacialRecognitionVerify\",\n  \"startFacialRecognitionVerifyAndUploadVideo\",\n  \"startCustomFacialRecognitionVerify\",\n  \"startCustomFacialRecognitionVerifyAndUploadVideo\",\n  \"sendBizRedPacket\",\n  \"sendGoldenRedPacket\",\n  \"openGoldenRedPacketDetail\",\n  \"addPhoneContact\",\n  \"setScreenBrightness\",\n  \"getScreenBrightness\",\n  \"getWeRunData\",\n  \"uploadWeRunData\",\n  \"addWeRunData\",\n  \"canIUse\",\n  \"setPageStyle\",\n  \"triggerGettingWidgetData\",\n  \"navigateToMiniProgram\",\n  \"navigateToMiniProgramDirectly\",\n  \"navigateToDevMiniProgram\",\n  \"navigateBackMiniProgram\",\n  \"launchMiniProgram\",\n  \"launchApplicationDirectly\",\n  \"setNavigationBarRightButton\",\n  \"onTapNavigationBarRightButton\",\n  \"setTopBarText\",\n  \"setTabBarBadge\",\n  \"removeTabBarBadge\",\n  \"showTabBarRedDot\",\n  \"hideTabBarRedDot\",\n  \"showTabBar\",\n  \"hideTabBar\",\n  \"setTabBarStyle\",\n  \"setTabBarItem\",\n  \"setBackgroundColor\",\n  \"setBackgroundTextStyle\",\n  \"setEnableDebug\",\n  \"captureScreen\",\n  \"onUserCaptureScreen\",\n  \"setKeepScreenOn\",\n  \"checkIsSupportSoterAuthentication\",\n  \"startSoterAuthentication\",\n  \"checkIsSoterEnrolledInDevice\",\n  \"openDeliveryList\",\n  \"navigateBackH5\",\n  \"openBusinessView\",\n  \"navigateBackApplication\",\n  \"navigateBackNative\",\n  \"reportIDKey\",\n  \"reportKeyValue\",\n  \"setNavigationBarTitle\",\n  \"showNavigationBarLoading\",\n  \"hideNavigationBarLoading\",\n  \"startPullDownRefresh\",\n  \"stopPullDownRefresh\",\n  \"operateWXData\",\n  \"getOpenDeviceId\",\n  \"getMenuButtonBoundingClientRect\",\n  \"getSelectedTextRange\",\n  \"openBluetoothAdapter\",\n  \"closeBluetoothAdapter\",\n  \"getBluetoothAdapterState\",\n  \"onBluetoothAdapterStateChange\",\n  \"startBluetoothDevicesDiscovery\",\n  \"stopBluetoothDevicesDiscovery\",\n  \"getBluetoothDevices\",\n  \"getConnectedBluetoothDevices\",\n  \"createBLEConnection\",\n  \"closeBLEConnection\",\n  \"getBLEDeviceServices\",\n  \"getBLEDeviceCharacteristics\",\n  \"notifyBLECharacteristicValueChanged\",\n  \"notifyBLECharacteristicValueChange\",\n  \"readBLECharacteristicValue\",\n  \"writeBLECharacteristicValue\",\n  \"onBluetoothDeviceFound\",\n  \"onBLEConnectionStateChanged\",\n  \"onBLEConnectionStateChange\",\n  \"onBLECharacteristicValueChange\",\n  \"startBeaconDiscovery\",\n  \"stopBeaconDiscovery\",\n  \"getBeacons\",\n  \"onBeaconUpdate\",\n  \"onBeaconServiceChange\",\n  \"startWifi\",\n  \"stopWifi\",\n  \"getWifiList\",\n  \"getConnectedWifi\",\n  \"connectWifi\",\n  \"presetWifiList\",\n  \"setWifiList\",\n  \"onGetWifiList\",\n  \"onWifiConnected\",\n  \"onEvaluateWifi\",\n  \"getHCEState\",\n  \"startHCE\",\n  \"stopHCE\",\n  \"sendHCEMessage\",\n  \"onHCEMessage\",\n  \"startLocalServiceDiscovery\",\n  \"stopLocalServiceDiscovery\",\n  \"onLocalServiceFound\",\n  \"offLocalServiceFound\",\n  \"onLocalServiceLost\",\n  \"offLocalServiceLost\",\n  \"onLocalServiceDiscoveryStop\",\n  \"offLocalServiceDiscoveryStop\",\n  \"onLocalServiceResolveFail\",\n  \"offLocalServiceResolveFail\",\n  \"redirectTo\",\n  \"reLaunch\",\n  \"navigateTo\",\n  \"switchTab\",\n  \"navigateBack\",\n  \"onAppShow\",\n  \"offAppShow\",\n  \"onAppHide\",\n  \"offAppHide\",\n  \"onError\",\n  \"offError\",\n  \"getLaunchOptionsSync\",\n  \"onWindowResize\",\n  \"offWindowResize\",\n  \"getStorage\",\n  \"getStorageSync\",\n  \"setStorage\",\n  \"setStorageSync\",\n  \"removeStorage\",\n  \"removeStorageSync\",\n  \"clearStorage\",\n  \"clearStorageSync\",\n  \"getStorageInfo\",\n  \"getStorageInfoSync\",\n  \"request\",\n  \"connectSocket\",\n  \"closeSocket\",\n  \"sendSocketMessage\",\n  \"onSocketOpen\",\n  \"onSocketClose\",\n  \"onSocketMessage\",\n  \"onSocketError\",\n  \"uploadFile\",\n  \"downloadFile\",\n  \"addNativeDownloadTask\",\n  \"calRqt\",\n  \"secureTunnel\",\n  \"chooseImage\",\n  \"previewImage\",\n  \"getImageInfo\",\n  \"saveImageToPhotosAlbum\",\n  \"compressImage\",\n  \"startRecord\",\n  \"stopRecord\",\n  \"playVoice\",\n  \"pauseVoice\",\n  \"stopVoice\",\n  \"onVoicePlayEnd\",\n  \"chooseVideo\",\n  \"saveVideoToPhotosAlbum\",\n  \"loadFontFace\",\n  \"getLocation\",\n  \"openLocation\",\n  \"chooseLocation\",\n  \"startLocationUpdate\",\n  \"stopLocationUpdate\",\n  \"onLocationChange\",\n  \"getNetworkType\",\n  \"onNetworkStatusChange\",\n  \"getSystemInfo\",\n  \"getSystemInfoSync\",\n  \"getBatteryInfo\",\n  \"getBatteryInfoSync\",\n  \"startAccelerometer\",\n  \"stopAccelerometer\",\n  \"onAccelerometerChange\",\n  \"startCompass\",\n  \"stopCompass\",\n  \"onCompassChange\",\n  \"startDeviceMotionListening\",\n  \"stopDeviceMotionListening\",\n  \"onDeviceMotionChange\",\n  \"startGyroscope\",\n  \"stopGyroscope\",\n  \"onGyroscopeChange\",\n  \"reportAction\",\n  \"getBackgroundAudioManager\",\n  \"getRecorderManager\",\n  \"getBackgroundAudioPlayerState\",\n  \"playBackgroundAudio\",\n  \"pauseBackgroundAudio\",\n  \"seekBackgroundAudio\",\n  \"stopBackgroundAudio\",\n  \"onBackgroundAudioPlay\",\n  \"onBackgroundAudioPause\",\n  \"onBackgroundAudioStop\",\n  \"joinVoIPChat\",\n  \"exitVoIPChat\",\n  \"updateVoIPChatMuteConfig\",\n  \"onVoIPChatMembersChanged\",\n  \"onVoIPChatSpeakersChanged\",\n  \"onVoIPChatInterrupted\",\n  \"login\",\n  \"checkSession\",\n  \"authorize\",\n  \"getUserInfo\",\n  \"requestPayment\",\n  \"verifyPaymentPassword\",\n  \"bindPaymentCard\",\n  \"requestPaymentToBank\",\n  \"requestVirtualPayment\",\n  \"openOfflinePayView\",\n  \"openWCPayCardList\",\n  \"requestMallPayment\",\n  \"setCurrentPaySpeech\",\n  \"loadPaySpeechDialectConfig\",\n  \"faceVerifyForPay\",\n  \"openOfficialAccountProfile\",\n  \"openMiniProgramProfile\",\n  \"openMiniProgramSearch\",\n  \"openMiniProgramHistoryList\",\n  \"openMiniProgramStarList\",\n  \"batchGetContactDirectly\",\n  \"preventApplePayUI\",\n  \"getWxSecData\",\n  \"addCard\",\n  \"openCard\",\n  \"scanCode\",\n  \"openQRCode\",\n  \"chooseAddress\",\n  \"saveFile\",\n  \"openDocument\",\n  \"getSavedFileList\",\n  \"getSavedFileInfo\",\n  \"getFileInfo\",\n  \"removeSavedFile\",\n  \"getFileSystemManager\",\n  \"getABTestConfig\",\n  \"chooseContact\",\n  \"removeUserCloudStorage\",\n  \"setUserCloudStorage\",\n  \"makePhoneCall\",\n  \"makeVoIPCall\",\n  \"onAppRoute\",\n  \"onAppRouteDone\",\n  \"onAppEnterBackground\",\n  \"onAppEnterForeground\",\n  \"onAppUnhang\",\n  \"onPageReload\",\n  \"onPageNotFound\",\n  \"offPageNotFound\",\n  \"createAnimation\",\n  \"createInnerAudioContext\",\n  \"getAvailableAudioSources\",\n  \"onAudioInterruptionBegin\",\n  \"offAudioInterruptionBegin\",\n  \"onAudioInterruptionEnd\",\n  \"offAudioInterruptionEnd\",\n  \"setInnerAudioOption\",\n  \"createAudioContext\",\n  \"createVideoContext\",\n  \"createMapContext\",\n  \"createCameraContext\",\n  \"createLivePlayerContext\",\n  \"createLivePusherContext\",\n  \"onWebviewEvent\",\n  \"onNativeEvent\",\n  \"hideKeyboard\",\n  \"onKeyboardHeightChange\",\n  \"getPublicLibVersion\",\n  \"showModal\",\n  \"showToast\",\n  \"hideToast\",\n  \"showLoading\",\n  \"hideLoading\",\n  \"showActionSheet\",\n  \"showShareActionSheet\",\n  \"reportAnalytics\",\n  \"reportMonitor\",\n  \"getClipboardData\",\n  \"setClipboardData\",\n  \"createSelectorQuery\",\n  \"createIntersectionObserver\",\n  \"nextTick\",\n  \"updatePerfData\",\n  \"traceEvent\",\n  \"onMemoryWarning\",\n  \"getUpdateManager\",\n  \"createWorker\",\n  \"voiceSplitJoint\",\n  \"uploadSilkVoice\",\n  \"downloadSilkVoice\",\n  \"getResPath\",\n  \"setResPath\",\n  \"setCookies\",\n  \"getCookies\",\n  \"getLabInfo\",\n  \"setLabInfo\",\n  \"createUDPSocket\",\n  \"env\",\n  \"createRewardedVideoAd\",\n  \"createInterstitialAd\",\n  \"getLogManager\",\n  \"getRealtimeLogManager\",\n  \"cloud\",\n  \"version\",\n  \"chooseShareGroup\",\n  \"enterContact\",\n];\n\nconst wxMock: any = {};\n\nwxApiName.forEach((apiName) => {\n  wxMock[apiName] = jest.fn();\n});\n\nObject.defineProperty(global, \"wx\", {\n  writable: true,\n  value: wxMock,\n});\n","const cache: any = {};\n\nexport interface IMockOptions {\n  /**\n   * 接口别名，用来保证唯一性\n   */\n  aliasName?: string;\n  apiOptions?: any;\n\n  [key: string]: any;\n}\n\nexport default class MockWxApi {\n  private cacheKey = \"no key\";\n  private resData = null;\n  private errData = null;\n  private mockType = \"success\";\n\n  constructor(apiName: string, options?: IMockOptions) {\n    if (options) {\n      this.cacheKey = `${apiName}.${JSON.stringify(options)}`;\n    }\n    this.cacheKey = apiName;\n    cache[this.cacheKey] = {\n      apiName,\n    };\n\n    global.wx[apiName] = jest.fn().mockImplementation((apiOptions) => {\n      const success =\n        apiOptions && apiOptions.success\n          ? apiOptions.success\n          : () => {\n              // do nothing\n            };\n      const fail =\n        apiOptions && apiOptions.fail\n          ? apiOptions.fail\n          : () => {\n              // do nothing\n            };\n      const complete =\n        apiOptions && apiOptions.complete\n          ? apiOptions.complete\n          : () => {\n              // do nothing\n            };\n\n      if (this.mockType === \"success\") {\n        const resData = cache[this.cacheKey].resData;\n        if (typeof resData === \"function\") {\n          success(resData());\n        } else {\n          success(cache[this.cacheKey].resData);\n        }\n        complete();\n        return;\n      }\n\n      if (this.mockType === \"fail\") {\n        const errData = cache[this.cacheKey].errData;\n        if (typeof errData === \"function\") {\n          fail(errData());\n        } else {\n          fail(cache[this.cacheKey].errData);\n        }\n        complete();\n      }\n    });\n  }\n\n  name(aliasName: string) {\n    this.cacheKey = aliasName;\n    return this;\n  }\n\n  success(res?: any) {\n    this.mockType = \"success\";\n    this.resData = res;\n\n    cache[this.cacheKey].resData = this.resData;\n    return global.wx[cache[this.cacheKey].apiName];\n  }\n\n  fail(err?: any) {\n    this.mockType = \"fail\";\n    this.errData = err;\n\n    cache[this.cacheKey].errData = this.errData;\n    return global.wx[cache[this.cacheKey].apiName];\n  }\n}\n","/* eslint-disable @typescript-eslint/no-namespace */\nimport \"./wxMock\";\nimport mockGlobal from \"./core/MockWxGlobal\";\nimport MockWxApi, { IMockOptions } from \"./core/MockWxApi\";\n\ndeclare global {\n  namespace NodeJS {\n    interface Global {\n      wx: {\n        [key: string]: jest.Mock;\n      };\n\n      [key: string]: jest.Mock;\n    }\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n// declare const wx: NodeJS.Global[\"wx\"];\n\nif (global.wx) {\n  global.wx = {\n    ...global.wx,\n  };\n} else {\n  global.wx = {};\n}\n\nmockGlobal();\n\nclass Mock {\n  mock(apiName: string, options?: IMockOptions) {\n    return new MockWxApi(apiName, options);\n  }\n\n  mockGlobal(apiName: string) {\n    global[apiName] = jest.fn();\n    return global[apiName];\n  }\n}\n\nexport default Mock;\n","export default function mockGlobal() {\n  global.getCurrentPages = jest.fn();\n  global.getApp = jest.fn();\n  global.App = jest.fn();\n  global.Page = jest.fn();\n  global.Component = jest.fn();\n  global.Behavior = jest.fn();\n}\n"],"names":["wxMock","forEach","apiName","jest","fn","Object","defineProperty","global","writable","value","cache","options","this","cacheKey","JSON","stringify","wx","mockImplementation","apiOptions","success","fail","complete","_this","mockType","resData","errData","MockWxApi","aliasName","res","err","getCurrentPages","getApp","App","Page","Component","Behavior","Mock"],"mappings":";;;;;;;;;;;;;;mSAuVMA,EAAc,GAvVF,CAChB,aACA,gBACA,sBACA,uBACA,qBACA,qBACA,wBACA,qBACA,eACA,eACA,qBACA,gBACA,sBACA,sBACA,cACA,eACA,cACA,mBACA,oBACA,sBACA,2BACA,qCACA,mBACA,gBACA,gBACA,kBACA,+BACA,UACA,wBACA,wBACA,eACA,cACA,aACA,kCACA,+BACA,6CACA,qCACA,mDACA,mBACA,sBACA,4BACA,kBACA,sBACA,sBACA,eACA,kBACA,eACA,UACA,eACA,2BACA,wBACA,gCACA,2BACA,0BACA,oBACA,4BACA,8BACA,gCACA,gBACA,iBACA,oBACA,mBACA,mBACA,aACA,aACA,iBACA,gBACA,qBACA,yBACA,iBACA,gBACA,sBACA,kBACA,oCACA,2BACA,+BACA,mBACA,iBACA,mBACA,0BACA,qBACA,cACA,iBACA,wBACA,2BACA,2BACA,uBACA,sBACA,gBACA,kBACA,kCACA,uBACA,uBACA,wBACA,2BACA,gCACA,iCACA,gCACA,sBACA,+BACA,sBACA,qBACA,uBACA,8BACA,sCACA,qCACA,6BACA,8BACA,yBACA,8BACA,6BACA,iCACA,uBACA,sBACA,aACA,iBACA,wBACA,YACA,WACA,cACA,mBACA,cACA,iBACA,cACA,gBACA,kBACA,iBACA,cACA,WACA,UACA,iBACA,eACA,6BACA,4BACA,sBACA,uBACA,qBACA,sBACA,8BACA,+BACA,4BACA,6BACA,aACA,WACA,aACA,YACA,eACA,YACA,aACA,YACA,aACA,UACA,WACA,uBACA,iBACA,kBACA,aACA,iBACA,aACA,iBACA,gBACA,oBACA,eACA,mBACA,iBACA,qBACA,UACA,gBACA,cACA,oBACA,eACA,gBACA,kBACA,gBACA,aACA,eACA,wBACA,SACA,eACA,cACA,eACA,eACA,yBACA,gBACA,cACA,aACA,YACA,aACA,YACA,iBACA,cACA,yBACA,eACA,cACA,eACA,iBACA,sBACA,qBACA,mBACA,iBACA,wBACA,gBACA,oBACA,iBACA,qBACA,qBACA,oBACA,wBACA,eACA,cACA,kBACA,6BACA,4BACA,uBACA,iBACA,gBACA,oBACA,eACA,4BACA,qBACA,gCACA,sBACA,uBACA,sBACA,sBACA,wBACA,yBACA,wBACA,eACA,eACA,2BACA,2BACA,4BACA,wBACA,QACA,eACA,YACA,cACA,iBACA,wBACA,kBACA,uBACA,wBACA,qBACA,oBACA,qBACA,sBACA,6BACA,mBACA,6BACA,yBACA,wBACA,6BACA,0BACA,0BACA,oBACA,eACA,UACA,WACA,WACA,aACA,gBACA,WACA,eACA,mBACA,mBACA,cACA,kBACA,uBACA,kBACA,gBACA,yBACA,sBACA,gBACA,eACA,aACA,iBACA,uBACA,uBACA,cACA,eACA,iBACA,kBACA,kBACA,0BACA,2BACA,2BACA,4BACA,yBACA,0BACA,sBACA,qBACA,qBACA,mBACA,sBACA,0BACA,0BACA,iBACA,gBACA,eACA,yBACA,sBACA,YACA,YACA,YACA,cACA,cACA,kBACA,uBACA,kBACA,gBACA,mBACA,mBACA,sBACA,6BACA,WACA,iBACA,aACA,kBACA,mBACA,eACA,kBACA,kBACA,oBACA,aACA,aACA,aACA,aACA,aACA,aACA,kBACA,MACA,wBACA,uBACA,gBACA,wBACA,QACA,UACA,mBACA,gBAKQC,SAAQ,SAACC,GACjBF,EAAOE,GAAWC,KAAKC,QAGzBC,OAAOC,eAAeC,OAAQ,KAAM,CAClCC,UAAU,EACVC,MAAOT,IC/VT,IAAMU,EAAa,gBAkBjB,WAAYR,EAAiBS,GAA7B,WALQC,cAAW,SACXA,aAAU,KACVA,aAAU,KACVA,cAAW,UAGbD,IACFC,KAAKC,SAAcX,MAAWY,KAAKC,UAAUJ,IAE/CC,KAAKC,SAAWX,EAChBQ,EAAME,KAAKC,UAAY,CACrBX,WAGFK,OAAOS,GAAGd,GAAWC,KAAKC,KAAKa,oBAAmB,SAACC,GACjD,IAAMC,EACJD,GAAcA,EAAWC,QACrBD,EAAWC,QACX,aAGAC,EACJF,GAAcA,EAAWE,KACrBF,EAAWE,KACX,aAGAC,EACJH,GAAcA,EAAWG,SACrBH,EAAWG,SACX,aAIN,GAAsB,YAAlBC,EAAKC,SAAwB,CAC/B,IAAMC,EAAUd,EAAMY,EAAKT,UAAUW,QAOrC,OALEL,EADqB,mBAAZK,EACDA,IAEAd,EAAMY,EAAKT,UAAUW,cAE/BH,IAIF,GAAsB,SAAlBC,EAAKC,SAAqB,CAC5B,IAAME,EAAUf,EAAMY,EAAKT,UAAUY,QAEnCL,EADqB,mBAAZK,EACJA,IAEAf,EAAMY,EAAKT,UAAUY,SAE5BJ,QAyBR,OApBEK,iBAAA,SAAKC,GAEH,OADAf,KAAKC,SAAWc,EACTf,MAGTc,oBAAA,SAAQE,GAKN,OAJAhB,KAAKW,SAAW,UAChBX,KAAKY,QAAUI,EAEflB,EAAME,KAAKC,UAAUW,QAAUZ,KAAKY,QAC7BjB,OAAOS,GAAGN,EAAME,KAAKC,UAAUX,UAGxCwB,iBAAA,SAAKG,GAKH,OAJAjB,KAAKW,SAAW,OAChBX,KAAKa,QAAUI,EAEfnB,EAAME,KAAKC,UAAUY,QAAUb,KAAKa,QAC7BlB,OAAOS,GAAGN,EAAME,KAAKC,UAAUX,eCpEtCK,OAAOS,GACTT,OAAOS,QACFT,OAAOS,IAGZT,OAAOS,GAAK,GCxBZT,OAAOuB,gBAAkB3B,KAAKC,KAC9BG,OAAOwB,OAAS5B,KAAKC,KACrBG,OAAOyB,IAAM7B,KAAKC,KAClBG,OAAO0B,KAAO9B,KAAKC,KACnBG,OAAO2B,UAAY/B,KAAKC,KACxBG,OAAO4B,SAAWhC,KAAKC,sBDwBzB,cASA,OAREgC,iBAAA,SAAKlC,EAAiBS,GACpB,OAAO,IAAIe,EAAUxB,EAASS,IAGhCyB,uBAAA,SAAWlC,GAET,OADAK,OAAOL,GAAWC,KAAKC,KAChBG,OAAOL"}