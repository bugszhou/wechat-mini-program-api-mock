{"version":3,"file":"miniprogramMock.es.js","sources":["../src/miniprogramMock.ts"],"sourcesContent":["interface IMockOptions {\n  /**\n   * 接口别名，用来保证唯一性\n   */\n  aliasName?: string;\n  apiOptions?: any;\n\n  [key: string]: any;\n}\n\nconst cache: any = {};\n\nclass MockWxApi {\n  private cacheKey = \"no key\";\n  private resData = null;\n  private errData = null;\n\n  constructor(apiName: string, options?: IMockOptions) {\n    if (options) {\n      this.cacheKey = `${apiName}.${JSON.stringify(options)}`;\n    }\n    this.cacheKey = apiName;\n    cache[this.cacheKey] = {\n      apiName,\n    };\n\n    global.wx[apiName] = jest.fn().mockImplementation((apiOptions) => {\n      const success =\n        apiOptions && apiOptions.success\n          ? apiOptions.success\n          : () => {\n              // do nothing\n            };\n      const fail =\n        apiOptions && apiOptions.fail\n          ? apiOptions.fail\n          : () => {\n              // do nothing\n            };\n      const complete =\n        apiOptions && apiOptions.complete\n          ? apiOptions.complete\n          : () => {\n              // do nothing\n            };\n\n      if (this.resData) {\n        const resData = cache[this.cacheKey].resData;\n        if (typeof resData === \"function\") {\n          success(resData());\n        } else {\n          success(cache[this.cacheKey].resData);\n        }\n        complete();\n      }\n\n      if (this.errData) {\n        const errData = cache[this.cacheKey].errData;\n        if (typeof errData === \"function\") {\n          fail(errData());\n        } else {\n          fail(cache[this.cacheKey].errData);\n        }\n        complete();\n      }\n    });\n  }\n\n  name(aliasName: string) {\n    this.cacheKey = aliasName;\n    return this;\n  }\n\n  success(res: any) {\n    if (typeof res === \"undefined\" || res === null) {\n      this.resData = null;\n    } else {\n      this.resData = res;\n    }\n\n    cache[this.cacheKey].resData = this.resData;\n    return global.wx[cache[this.cacheKey].apiName];\n  }\n\n  fail(err: any) {\n    if (typeof err === \"undefined\" || err === null) {\n      this.errData = null;\n    } else {\n      this.errData = err;\n    }\n\n    cache[this.cacheKey].errData = this.errData;\n    return global.wx[cache[this.cacheKey].apiName];\n  }\n}\n\nclass Mock {\n  mock(apiName: string, options?: IMockOptions) {\n    return new MockWxApi(apiName, options);\n  }\n}\n\nexport default Mock;\n"],"names":[],"mappings":"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"}